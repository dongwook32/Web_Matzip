<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>맛집 지도 (한식·중식·일식)</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Leaflet MarkerCluster CSS (마커 클러스터링) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
  
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    /* 카테고리 버튼 (좌측 상단) */
    .btn-container {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      display: flex;
      gap: 8px;
    }
    .btn-container button {
      display: flex;
      align-items: center;
      gap: 4px;
      background: #4caf50;
      color: #fff;
      border: 0;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: background 0.2s;
    }
    .btn-container button:hover {
      background: #45a049;
    }
    /* 범례 (상단 중앙, 그대로 유지) */
    .legend {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.9);
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 0.9rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      z-index: 1000;
    }
    .legend img {
      vertical-align: middle;
      margin-right: 4px;
    }
    /* 줌 슬라이더 (우측 상단, top:50px) */
    .zoom-slider-vertical {
      position: absolute;
      top: 50px;
      right: 10px;
      z-index: 1000;
      background: rgba(255,255,255,0.9);
      padding: 8px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 220px;
    }
    .zoom-slider-vertical input[type=range] {
      -webkit-appearance: slider-vertical;
      writing-mode: bt-lr;
      width: 8px;
      height: 160px;
      margin-bottom: 8px;
      background: transparent;
    }
    .zoom-slider-vertical input[type=range]::-webkit-slider-runnable-track,
    .zoom-slider-vertical input[type=range]::-moz-range-track {
      width: 8px;
      height: 160px;
      background: repeating-linear-gradient(
        to bottom,
        transparent 0px,
        transparent 24px,
        #888 24px,
        #888 25px
      );
    }
    .zoom-slider-vertical span {
      font-size: 0.9rem;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .zoom-slider-vertical .slider-buttons {
      display: flex;
      flex-direction: column;
      gap: 4px;
      width: 24px;
    }
    .zoom-slider-vertical .slider-buttons button {
      width: 24px;
      height: 24px;
      background: #4caf50;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .zoom-slider-vertical .slider-buttons button:hover {
      background: #45a049;
    }
    .hide-overlay {
      color: white;
      pointer-events: none;
    }
    /* 좌측 하단 축척 컨트롤 – 이전 디자인 그대로 */
    .leaflet-control-scale {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid #333;
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 1rem;
      color: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      min-width: 100px;
      /* 아래 추가하여 ft와 m의 칸 분리 */
      display: flex;
      justify-content: space-between;
    }
    .leaflet-control-scale .leaflet-control-scale-line-metric {
      flex: 1;
      text-align: left;
    }
    .leaflet-control-scale .leaflet-control-scale-line-imperial {
      flex: 1;
      text-align: right;
    }
    /* 즐겨찾기 버튼 (오른쪽 상단, 둥근 네모 안에 별) */
    #toggleFavorites {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1100;
      background: #fff;
      border: 2px solid #FFEB3B;
      padding: 8px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.5rem;
      color: #FFEB3B;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      transition: background 0.2s, color 0.2s;
    }
    #toggleFavorites:hover {
      background: #FFEB3B;
      color: #fff;
    }
    /* 즐겨찾기 패널 (우측 사이드바) */
    #favorites-panel {
      position: fixed;
      top: 60px;
      right: 0;
      width: 300px;
      height: calc(100% - 60px);
      background: rgba(255,255,255,0.95);
      box-shadow: -2px 0 6px rgba(0,0,0,0.3);
      padding: 16px;
      overflow-y: auto;
      z-index: 1100;
      display: none;
    }
    #favorites-panel h2 {
      margin-top: 0;
      font-size: 1.1rem;
      margin-bottom: 12px;
    }
    .favorite-item {
      padding: 8px 0;
      border-bottom: 1px solid #ddd;
    }
    .favorite-item:last-child {
      border-bottom: none;
    }
    .favorite-item .info {
      font-size: 0.85rem;
      color: #555;
      margin: 4px 0;
    }
    .favorite-item button {
      background: #f44336;
      color: #fff;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
    }
    .favorite-item button:hover {
      background: #d32f2f;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <!-- 카테고리 버튼 (좌측 상단) -->
  <div class="btn-container">
    <button id="btn-korean"><i class="fas fa-bowl-rice"></i> 한식</button>
    <button id="btn-chinese"><i class="fas fa-utensils"></i> 중식</button>
    <button id="btn-japanese"><i class="fas fa-fish"></i> 일식</button>
  </div>
  
  <!-- 범례 (상단 중앙) -->
  <div class="legend">
    <img src="https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png" width="16" height="28"> 일반 가게&nbsp;
    <img src="https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png" width="16" height="28"> 제휴 업체
  </div>
  
  <!-- 즐겨찾기 버튼 (오른쪽 상단, 둥근 네모 안에 별 아이콘) -->
  <button id="toggleFavorites"><i class="fas fa-star"></i></button>
  
  <!-- 즐겨찾기 패널 (우측 사이드바) -->
  <div id="favorites-panel">
    <h2>즐겨찾기 목록</h2>
    <div id="favorites-list">
      <!-- 즐겨찾기 아이템들이 여기에 추가됩니다 -->
    </div>
  </div>
  
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Leaflet MarkerCluster JS (마커 클러스터링) -->
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <script>
    /*********************
     * 전역 변수 설정
     *********************/
    var markerClusterGroup = null; // 마커 클러스터링 그룹
    var current = [];              // 현재 지도에 표시 중인 마커 배열
    var favorites = [];            // 즐겨찾기 목록 (가게 이름 저장)
    
    /*********************
     * 대한민국 경계 (유지)
     *********************/
    var koreaBounds = [[33.0, 124.0], [39.5, 132.0]];
    
    /*********************
     * 지도 스타일 전환 (Feature 6)
     * 기본 바닥 레이어: OSM Standard("일반 지도") / Esri Satellite("위성 지도")
     *********************/
    var osmStandard = L.tileLayer(
      "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
      { attribution: "&copy; OpenStreetMap contributors" }
    );
    var esriSat = L.tileLayer(
      "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
      { attribution: "Tiles &copy; Esri" }
    );
    
    /*********************
     * 지도 생성 (기존)
     *********************/
    var map = L.map("map", {
      center: [37.648694, 127.064194],
      zoom: 16,
      minZoom: 6,
      maxZoom: 18,
      maxBounds: koreaBounds,
      maxBoundsViscosity: 1.0,
      zoomControl: false
    });
    osmStandard.addTo(map);
    
    // 기본 마커 재추가: 한국성서대학교 (아이콘 정의 이후에 추가하도록 함)
    
    /*********************
     * 지도 스타일 전환 컨트롤 (하단 우측)
     *********************/
    var baseLayers = {
      "일반 지도": osmStandard,
      "위성 지도": esriSat
    };
    L.control.layers(baseLayers, null, { position: "bottomright" }).addTo(map);
    
    /*********************
     * 축척 컨트롤 (좌측 하단, 기존 디자인 그대로 + ft / m 칸 분리)
     *********************/
    L.control.scale({ position: "bottomleft" }).addTo(map);
    
    /*********************
     * 외부 흰 배경 마스크 (유지)
     *********************/
    var masks = [
      [[-90, -180], [90, 124]],
      [[-90, 132], [90, 180]],
      [[39.5, 124], [90, 132]],
      [[-90, 124], [33.0, 132]]
    ];
    masks.forEach(function (b) {
      L.rectangle(b, {
        color: "white",
        weight: 0,
        fillOpacity: 1,
        interactive: false
      }).addTo(map);
    });
    
    /*********************
     * 커스텀 줌 슬라이더 (우측 상단, top:50px)
     *********************/
    var ZoomSliderV = L.Control.extend({
      options: { position: "topright" },
      onAdd: function () {
        var ctr = L.DomUtil.create("div", "zoom-slider-vertical");
        var iv = Math.round(
          ((map.getZoom() - map.getMinZoom()) / (map.getMaxZoom() - map.getMinZoom())) *
          (30 / 5)
        ) * 5;
        ctr.innerHTML =
          '<input type="range" id="zoom-range-v" min="0" max="30" step="5" value="' +
          iv +
          '">' +
          '<span id="zoom-value-v">' + iv + "</span>" +
          '<div class="slider-buttons"><button id="zoom-increase">+</button><button id="zoom-decrease">-</button></div>';
        L.DomEvent.disableClickPropagation(ctr);
        return ctr;
      }
    });
    map.addControl(new ZoomSliderV());
    
    /*********************
     * 슬라이더 이벤트 (유지)
     *********************/
    function sliderToZoom(v) {
      var ratio = v / 30;
      map.setZoom(map.getMinZoom() + ratio * (map.getMaxZoom() - map.getMinZoom()));
    }
    var slider = document.getElementById("zoom-range-v"),
        display = document.getElementById("zoom-value-v");
    slider.addEventListener("input", function () {
      display.textContent = this.value;
      sliderToZoom(+this.value);
    });
    map.on("zoomend", function () {
      var v = Math.round(
        ((map.getZoom() - map.getMinZoom()) / (map.getMaxZoom() - map.getMinZoom())) *
        (30 / 5)
      ) * 5;
      slider.value = v;
      display.textContent = v;
      if (map.getZoom() < 14) map.closePopup();
    });
    document.addEventListener("click", function (e) {
      if (e.target.id === "zoom-increase") {
        var v = Math.min(30, +slider.value + 5);
        slider.value = v;
        display.textContent = v;
        sliderToZoom(v);
      }
      if (e.target.id === "zoom-decrease") {
        var v = Math.max(0, +slider.value - 5);
        slider.value = v;
        display.textContent = v;
        sliderToZoom(v);
      }
    });
    
    /*********************
     * 아이콘 정의 (유지) - 기본 마커 아이콘 등은 아래에 정의
     *********************/
    var blueIcon = new L.Icon({
      iconUrl: "https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",
      shadowUrl: "https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });
    var yellowIcon = new L.Icon({
      iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png",
      shadowUrl: "https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });
    
    /*********************
     * 기본 마커 재추가: 한국성서대학교 (페이지 진입 시)
     *********************/
    L.marker([37.648694, 127.064194], { icon: blueIcon })
      .addTo(map)
      .bindPopup("<strong>한국성서대학교</strong>")
      .openPopup();
    
    /*********************
     * 한식 가게 데이터
     *********************/
    var koreanShops = [
      {
        coords: [37.648558864743464, 127.06203685094735],
        name: "영성식당 (한식)",
        img: "C:/Users/CDW/HTML_Webclass/media/영성식당.jpg",
        partner: true,
        info: "테이블 당 캔 음료 1개 or 계란찜 제공",
        location: "서울 용산구", 
        phone: "02-931-0001",
        hours: "10:00~22:00"
      },
      {
        coords: [37.650746083563845, 127.06188002539936],
        name: "국수나무 (한식)",
        img: "C:/Users/CDW/HTML_Webclass/media/국수나무.jpg",
        partner: false,
        location: "서울 용산구",
        phone: "정보 없음",
        hours: "정보 없음"
      },
      {
        coords: [37.650218765642684, 127.06234135464992],
        name: "국시집 (한식)",
        img: "C:/Users/CDW/HTML_Webclass/media/국시집.jpg",
        partner: true,
        info: "닭, 멸치 국시, 냉모밀 1.5배 제공",
        location: "서울 용산구",
        phone: "정보 없음",
        hours: "정보 없음"
      }
    ];
    
    /*********************
     * 중식 가게 데이터 (총 10개)
     *********************/
    var chineseShops = [
      {
        coords: [37.6479919478235, 127.062242496877],
        name: "슈엔차이",
        img: "https://via.placeholder.com/120?text=슈엔차이",
        partner: true,
        info: "브레이크 15:00~16:30",
        location: "서울 노원구 상계동 763-4",
        phone: "02-933-3345",
        hours: "11:00~21:00"
      },
      {
        coords: [37.649408246899, 127.062330705355],
        name: "금화 반점",
        img: "https://via.placeholder.com/120?text=금화반점",
        partner: false,
        location: "서울 노원구 상계동 749-7",
        phone: "정보 없음",
        hours: "11:30~21:00"
      },
      {
        coords: [37.6498808620377, 127.062236934343],
        name: "중식당규규",
        img: "https://via.placeholder.com/120?text=규규",
        partner: true,
        info: "브레이크 16:00~17:00, 라스트 21:20",
        location: "서울 노원구 동일로 1356 상가동2층 212호",
        phone: "0507-1349-8336",
        hours: "11:00~22:00"
      },
      {
        coords: [37.65675199926709, 127.06446603030311],
        name: "설화",
        img: "https://via.placeholder.com/120?text=설화",
        partner: true,
        info: "브레이크 15:00~17:00, 라스트 21:30",
        location: "서울 노원구 상계로5길 12 동양상가 2층 (202-1호)",
        phone: "02-933-4485",
        hours: "11:30~22:00"
      },
      {
        coords: [37.6544548276974, 127.062677840248],
        name: "홍콩반점0410 노원역남부",
        img: "https://via.placeholder.com/120?text=홍콩반점",
        partner: false,
        info: "",
        location: "서울 노원구 노해로 502 (상계동) 2층 (KT노원지사)",
        phone: "정보 없음",
        hours: "11:00~21:30 (라스트 21:00)"
      },
      {
        coords: [37.6544548276974, 127.062677840248],
        name: "가양 훠궈 샤브샤브",
        img: "https://via.placeholder.com/120?text=가양훠궈",
        partner: false,
        info: "무한리필",
        location: "서울 노원구 노해로 492 2층 203호",
        phone: "정보 없음",
        hours: "11:00~22:00"
      },
      {
        coords: [37.6551188125687, 127.063089199491],
        name: "탕화쿵푸마라탕 노원역점",
        img: "https://via.placeholder.com/120?text=탕화쿵푸",
        partner: false,
        info: "매주 화요일 휴무",
        location: "서울 노원구 노해로 495 202호",
        phone: "정보 없음",
        hours: "11:00~21:00"
      },
      {
        coords: [37.6557918268818, 127.062277905261],
        name: "신미방 마라탕 노원점",
        img: "https://via.placeholder.com/120?text=신미방마라탕",
        partner: false,
        info: "",
        location: "서울 노원구 상계로 64 1층 2호",
        phone: "070-7576-1883",
        hours: "10:40~22:40"
      },
      {
        coords: [37.6559815855142, 127.064601468448],
        name: "청도양꼬치 노원점",
        img: "https://via.placeholder.com/120?text=청도양꼬치",
        partner: false,
        info: "",
        location: "서울 노원구 노해로83길 18-6 2층",
        phone: "0507-1376-2242",
        hours: "15:00~04:00"
      },
      {
        coords: [37.6563543249568, 127.062249590194],
        name: "춘리마라탕 노원점",
        img: "https://via.placeholder.com/120?text=춘리마라탕",
        partner: false,
        info: "",
        location: "서울 노원구 상계로 65",
        phone: "02-933-2156",
        hours: "10:30~22:00"
      }
    ];
    
    /*********************
     * Feature 7: 즐겨찾기 토글 및 공유 기능
     *********************/
    function toggleFavorite(shopName) {
      var index = favorites.indexOf(shopName);
      if (index === -1) {
        favorites.push(shopName);
        alert(shopName + "이(가) 즐겨찾기에 추가되었습니다.");
      } else {
        favorites.splice(index, 1);
        alert(shopName + "이(가) 즐겨찾기에서 제거되었습니다.");
      }
      updateFavoritesPanel();
    }
    function shareShop(shopName) {
      var shareUrl = "https://example.com/?shop=" + encodeURIComponent(shopName);
      alert("공유할 URL: " + shareUrl);
    }
    
    /*********************
     * 즐겨찾기 패널 UI 업데이트 함수
     *********************/
    function updateFavoritesPanel() {
      var favoritesList = document.getElementById("favorites-list");
      if (favorites.length === 0) {
        favoritesList.innerHTML = "<p>즐겨찾기가 비어있습니다.</p>";
      } else {
        favoritesList.innerHTML = "";
        // 한식과 중식 데이터 합쳐서 favorites에 포함된 항목을 찾음
        var combinedShops = koreanShops.concat(chineseShops);
        combinedShops.forEach(function(shop) {
          if (favorites.indexOf(shop.name) !== -1) {
            var item = document.createElement("div");
            item.className = "favorite-item";
            item.innerHTML =
              "<strong>" + shop.name + "</strong>" +
              "<div class='info'>위치: " + shop.location + "</div>" +
              "<div class='info'>전화번호: " + (shop.phone || "정보 없음") + "</div>" +
              "<div class='info'>이용시간: " + shop.hours + "</div>" +
              "<button onclick=\"toggleFavorite('" + shop.name + "')\">삭제</button>";
            favoritesList.appendChild(item);
          }
        });
      }
    }
    
    /*********************
     * 즐겨찾기 패널 토글 버튼 이벤트 (별 아이콘 버튼)
     *********************/
    document.getElementById("toggleFavorites").addEventListener("click", function() {
      var panel = document.getElementById("favorites-panel");
      if (panel.style.display === "none" || panel.style.display === "") {
        panel.style.display = "block";
        updateFavoritesPanel();
      } else {
        panel.style.display = "none";
      }
    });
    
    /*********************
     * Feature 5 & 7: 마커 클러스터링 및 즐겨찾기/공유 버튼 포함하여 맛집 표시
     *********************/
    function showCategory(list) {
      if (markerClusterGroup) {
        map.removeLayer(markerClusterGroup);
      }
      markerClusterGroup = L.markerClusterGroup();
      current = [];
      list.forEach(function(s) {
        var icon = s.partner ? yellowIcon : blueIcon;
        var popup =
          '<div style="text-align:center;">' +
            '<div style="font-weight:bold; margin-bottom:4px;">' + s.name + '</div>' +
            '<img src="' + s.img + '" style="width:120px; border-radius:8px; cursor:pointer;" onclick="map.closePopup()" />' +
            (s.info ? '<br/><button style="margin-top:6px; padding:4px 8px; font-size:0.8rem; color:#fff; background:#2196F3; border:none; border-radius:4px; cursor:pointer;" onclick="alert(\'' + s.info + '\')">제휴정보</button>' : "") +
            '<br/><button style="margin-top:6px; padding:4px 8px; font-size:0.8rem; color:#fff; background:#FF5722; border:none; border-radius:4px; cursor:pointer;" onclick="toggleFavorite(\'' + s.name + '\')">즐겨찾기</button>' +
            '<button style="margin-top:6px; padding:4px 8px; font-size:0.8rem; color:#fff; background:#009688; border:none; border-radius:4px; cursor:pointer; margin-left:4px;" onclick="shareShop(\'' + s.name + '\')">공유</button>' +
          "</div>";
        var m = L.marker(s.coords, { icon: icon })
          .bindPopup(popup, { autoClose: false, closeOnClick: false, offset: L.point(0, 0) });
        m.openPopup();  // 마커 생성 시 팝업 자동 오픈
        markerClusterGroup.addLayer(m);
        current.push(m);
      });
      map.addLayer(markerClusterGroup);
    }
    
    /*********************
     * 카테고리 버튼 이벤트
     * - 한식: koreanShops, 중식: chineseShops, 일식: 빈 배열(추후 추가 가능)
     *********************/
    document.getElementById("btn-korean").addEventListener("click", () => showCategory(koreanShops));
    document.getElementById("btn-chinese").addEventListener("click", () => showCategory(chineseShops));
    document.getElementById("btn-japanese").addEventListener("click", () => showCategory([]));
  </script>
</body>
</html>
