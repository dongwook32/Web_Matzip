<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>맛집 지도 (카테고리별 한식 핀)</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    html, body { height:100%; margin:0; padding:0; }
    #map { width:100%; height:100%; }
    .btn-container { position:absolute; top:10px; left:10px; z-index:1000; display:flex; gap:6px; }
    .btn-container button { display:flex; align-items:center; gap:4px; background:#4CAF50; color:#fff; border:2px solid #4CAF50; padding:6px 10px; border-radius:20px; cursor:pointer; font-size:0.9rem; box-shadow:0 2px 6px rgba(0,0,0,0.3); transition:background 0.2s; }
    .btn-container button:hover { background:#45A049; }
    .legend { position:absolute; top:10px; left:50%; transform:translateX(-50%); background:rgba(255,255,255,0.9); padding:6px 12px; border-radius:4px; font-size:0.9rem; box-shadow:0 2px 6px rgba(0,0,0,0.3); z-index:1000; }
    .legend img { vertical-align:middle; margin-right:4px; }
    .zoom-slider-vertical {
      position:absolute; top:60px; right:10px; z-index:1000;
      background:rgba(255,255,255,0.9); padding:8px; border-radius:8px;
      box-shadow:0 2px 6px rgba(0,0,0,0.3);
      display:flex; flex-direction:column; align-items:center;
      height:220px;
    }
    .zoom-slider-vertical input[type=range] {
      -webkit-appearance:slider-vertical;
      writing-mode:bt-lr;
      width:8px; height:160px;
      margin-bottom:8px;
      background:transparent;
    }
    .zoom-slider-vertical input[type=range]::-webkit-slider-runnable-track,
    .zoom-slider-vertical input[type=range]::-moz-range-track {
      width:8px; height:160px;
      background: repeating-linear-gradient(
        to bottom,
        transparent 0px,
        transparent 24px,
        #888 24px,
        #888 25px
      );
    }
    .zoom-slider-vertical span { font-size:0.9rem; font-weight:bold; margin-bottom:8px; }
    .zoom-slider-vertical .slider-buttons { display:flex; flex-direction:column; gap:4px; width:24px; }
    .zoom-slider-vertical .slider-buttons button {
      width:24px; height:24px; background:#4CAF50; color:#fff;
      border:none; border-radius:4px; cursor:pointer;
      font-size:1rem; display:flex; align-items:center; justify-content:center;
    }
    .zoom-slider-vertical .slider-buttons button:hover { background:#45A049; }
    .hide-overlay { fill:white; fill-opacity:1; stroke:none; pointer-events:none; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="btn-container">
    <button id="btn-korean"><i class="fas fa-bowl-rice"></i> 한식</button>
    <button id="btn-chinese"><i class="fas fa-utensils"></i> 중식</button>
    <button id="btn-japanese"><i class="fas fa-fish"></i> 일식</button>
  </div>
  <div class="legend">
    <img src="https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png" width="16" height="28"> 일반 가게&nbsp;&nbsp;
    <img src="https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png" width="16" height="28"> 제휴 업체
  </div>
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // 대한민국 경계 (독도 포함)
    var koreaBounds = [[33.0,124.0],[39.5,132.0]];
    var map = L.map('map', {
      center: [37.648694,127.064194],
      zoom: 16,
      minZoom: 6,
      maxZoom: 18,
      maxBounds: koreaBounds,
      maxBoundsViscosity: 1.0,
      zoomControl: false
    });
    // 대한민국 외부 흰색 마스크
    var masks = [
      [[-90,-180],[90,124]],
      [[-90,132],[90,180]],
      [[39.5,124],[90,132]],
      [[-90,124],[33.0,132]]
    ];
    masks.forEach(function(b) { L.rectangle(b, {color:'white', weight:0, fillOpacity:1, interactive:false}).addTo(map); });

    // 기본 타일 레이어
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // 축척 컨트롤 (좌하단)
    L.control.scale({ position: 'bottomleft' }).addTo(map);

    // 커스텀 줌 슬라이더 컨트롤
    var ZoomSliderV = L.Control.extend({
      options: { position: 'topright' },
      onAdd: function() {
        var container = L.DomUtil.create('div', 'zoom-slider-vertical');
        var iv = Math.round((map.getZoom()-map.getMinZoom())/(map.getMaxZoom()-map.getMinZoom())*30/5)*5;
        container.innerHTML =
          '<input type="range" id="zoom-range-v" min="0" max="30" step="5" value="'+ iv +'">' +
          '<span id="zoom-value-v">'+ iv +'</span>' +
          '<div class="slider-buttons">' +
            '<button id="zoom-increase">+</button>' +
            '<button id="zoom-decrease">-</button>' +
          '</div>';
        L.DomEvent.disableClickPropagation(container);
        return container;
      }
    });
    map.addControl(new ZoomSliderV());

    // 슬라이더 이벤트: 맵 줌 제어
    function sliderToZoom(v) {
      var ratio = v/30;
      var nz = map.getMinZoom() + ratio*(map.getMaxZoom()-map.getMinZoom());
      map.setZoom(nz);
    }
    var slider = document.getElementById('zoom-range-v');
    var display = document.getElementById('zoom-value-v');
    slider.addEventListener('input', function() {
      display.textContent = this.value;
      sliderToZoom(+this.value);
    });
    map.on('zoomend', function() {
      var v = Math.round((map.getZoom()-map.getMinZoom())/(map.getMaxZoom()-map.getMinZoom())*30/5)*5;
      slider.value = v;
      display.textContent = v;
      if (map.getZoom() < 14) map.closePopup();
    });
    document.addEventListener('click', function(e) {
      if (e.target.id === 'zoom-increase') {
        var val = Math.min(30, +slider.value + 5);
        slider.value = val; display.textContent = val;
        sliderToZoom(val);
      }
      if (e.target.id === 'zoom-decrease') {
        var val = Math.max(0, +slider.value - 5);
        slider.value = val; display.textContent = val;
        sliderToZoom(val);
      }
    });

    // 아이콘 정의
    var blueIcon = new L.Icon({ iconUrl:'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png', shadowUrl:'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41] });
    var yellowIcon = new L.Icon({ iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png', shadowUrl:'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41] });

    // 기본 마커
    L.marker([37.648694,127.064194], {icon:blueIcon}).addTo(map).bindPopup('<strong>한국성서대학교</strong>').openPopup();

    // 가게 데이터
    var shops = [
      {coords:[37.648558864743464,127.06203685094735],name:'영성식당',img:'C:/Users/CDW/HTML_Webclass/media/영성식당.jpg',partner:true,info:'테이블 당 캔 음료 1개 or 계란찜 제공(가게 상황에 따라 다름)'},
      {coords:[37.650746083563845,127.06188002539936],name:'국수나무',img:'C:/Users/CDW/HTML_Webclass/media/국수나무.jpg',partner:false},
      {coords:[37.650218765642684,127.06234135464992],name:'국시집',img:'C:/Users/CDW/HTML_Webclass/media/국시집.jpg',partner:true,info:'닭, 멸치 국시, 냉모밀 양 1.5배 제공'}
    ];
    var markers = [];
    function showCategory(list) {
      markers.forEach(m=>map.removeLayer(m)); markers=[];
      list.forEach(function(s) {
        var icon = s.partner?yellowIcon:blueIcon;
        var html = '<div style="text-align:center;"><div style="font-weight:bold;margin-bottom:4px;">'+s.name+'</div>'+
                   '<img src="'+s.img+'" style="width:120px;border-radius:8px;cursor:pointer;" onclick="map.closePopup()" />'+
                   (s.info?'<br/><button style="margin-top:6px;padding:4px 8px;font-size:0.8rem;color:#fff;background:#2196F3;border:none;border-radius:4px;cursor:pointer;" onclick="alert(\''+s.info+'\')">제휴정보</button>':'')+
                   '</div>';
        var m = L.marker(s.coords,{icon:icon}).addTo(map)
                  .bindPopup(html,{autoClose:false,closeOnClick:false,offset:L.point(0,-40)})
                  .openPopup();
        markers.push(m);
      });
    }
    document.getElementById('btn-korean').addEventListener('click',()=>showCategory(shops));
    document.getElementById('btn-chinese').addEventListener('click',()=>showCategory([]));
    document.getElementById('btn-japanese').addEventListener('click',()=>showCategory([]));
  </script>
</body>
</html>
